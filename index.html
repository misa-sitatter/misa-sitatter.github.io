<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MISA-SITATTER</title>
<style>
  body {
    font-family: Arial, sans-serif;
    text-align: center;
    background-color: #ffb6c1;
    color: white;
    margin: 0;
  }
  h1 {
    margin-top: 20px;
    font-size: 2em;
    text-shadow: 2px 2px #ff69b4;
  }
  #controls, #characterList {
    margin: 15px;
  }
  canvas {
    background-color: rgba(255,182,193,0.3); /* softer pink grid bg */
    border-radius: 10px;
    max-width: 95vw;
    max-height: 80vh;
    touch-action: none; /* allows touch drag */
  }
  .charCard {
    display: inline-block;
    background: rgba(255,255,255,0.2);
    padding: 10px;
    margin: 5px;
    border-radius: 8px;
  }
  .charCard img {
    display: block;
    max-width: 80px;
    margin: auto;
  }
  .charCard input[type="text"], .charCard input[type="number"] {
    width: 80px;
    margin-top: 5px;
    text-align: center;
  }
</style>
</head>
<body>
<h1>MISA-SITATTER</h1>
<div id="controls">
  <input type="file" id="fileInput" accept="image/png"><br><br>
  <input type="text" id="nameInput" placeholder="Name"><br><br>
  <input type="number" id="heightInput" placeholder="Height (cm)"><br><br>
  <button id="addBtn">Add Character</button>
</div>
<canvas id="chart"></canvas>
<div id="characterList"></div>
<script>
const canvas = document.getElementById('chart');
const ctx = canvas.getContext('2d');
let characters = [];
let draggingChar = null;
let dragOffsetX = 0;

function resizeCanvas() {
  canvas.width = window.innerWidth * 0.95;
  canvas.height = window.innerHeight * 0.8;
  draw();
}
window.addEventListener('resize', resizeCanvas);
resizeCanvas();

document.getElementById('addBtn').addEventListener('click', () => {
  const file = document.getElementById('fileInput').files[0];
  const name = document.getElementById('nameInput').value;
  const height = parseFloat(document.getElementById('heightInput').value);
  if (!file || !name || !height) return;
  const img = new Image();
  img.onload = () => {
    characters.push({img, name, height, x: 50});
    updateCharacterList();
    draw();
  };
  img.src = URL.createObjectURL(file);
});

function updateCharacterList() {
  const list = document.getElementById('characterList');
  list.innerHTML = '';
  characters.forEach((char, index) => {
    const card = document.createElement('div');
    card.className = 'charCard';

    const imgEl = document.createElement('img');
    imgEl.src = char.img.src;
    card.appendChild(imgEl);

    const nameInput = document.createElement('input');
    nameInput.type = 'text';
    nameInput.value = char.name;
    nameInput.addEventListener('input', e => {
      char.name = e.target.value;
      draw();
    });
    card.appendChild(nameInput);

    const heightInput = document.createElement('input');
    heightInput.type = 'number';
    heightInput.value = char.height;
    heightInput.addEventListener('input', e => {
      char.height = parseFloat(e.target.value) || char.height;
      draw();
    });
    card.appendChild(heightInput);

    const changeImg = document.createElement('input');
    changeImg.type = 'file';
    changeImg.accept = 'image/png';
    changeImg.addEventListener('change', e => {
      const file = e.target.files[0];
      if (file) {
        const newImg = new Image();
        newImg.onload = () => {
          char.img = newImg;
          draw();
          updateCharacterList();
        };
        newImg.src = URL.createObjectURL(file);
      }
    });
    card.appendChild(changeImg);

    const delBtn = document.createElement('button');
    delBtn.textContent = 'Delete';
    delBtn.addEventListener('click', () => {
      characters.splice(index, 1);
      updateCharacterList();
      draw();
    });
    card.appendChild(delBtn);

    list.appendChild(card);
  });
}

function drawGrid(maxHeight) {
  const pxPerCm = (canvas.height * 0.7) / maxHeight;
  ctx.lineWidth = 1;
  for (let cm = 0; cm <= maxHeight; cm += 5) {
    const y = canvas.height - (cm * pxPerCm) - 30;
    ctx.beginPath();
    ctx.moveTo(0, y);
    ctx.lineTo(canvas.width, y);
    ctx.strokeStyle = (cm % 10 === 0) ? 'rgba(255,255,255,0.8)' : 'rgba(255,255,255,0.4)';
    ctx.stroke();
    if (cm % 10 === 0) {
      ctx.fillStyle = 'white';
      ctx.font = '14px Arial';
      ctx.textAlign = 'left';
      ctx.fillText(cm + ' cm', 5, y - 2);
    }
  }
}

function draw() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  if (characters.length === 0) return;
  const tallest = Math.max(...characters.map(c => c.height));
  const maxHeight = tallest + 20;
  drawGrid(maxHeight);
  characters.forEach(char => {
    const scale = (canvas.height * 0.7 * (char.height / maxHeight)) / char.img.height;
    const w = char.img.width * scale;
    const h = char.img.height * scale;
    ctx.drawImage(char.img, char.x, canvas.height - h - 30, w, h);
    ctx.font = '20px Arial';
    ctx.fillStyle = 'white';
    ctx.textAlign = 'center';
    ctx.fillText(char.name, char.x + w / 2, canvas.height - h - 40);
    char._w = w;
    char._h = h;
  });
}

// Mouse + touch drag logic
function getCharAt(x, y) {
  return characters.find(char => {
    return x >= char.x && x <= char.x + char._w &&
           y >= canvas.height - char._h - 30 && y <= canvas.height - 30;
  });
}

function startDrag(x, y) {
  const char = getCharAt(x, y);
  if (char) {
    draggingChar = char;
    dragOffsetX = x - char.x;
  }
}

function moveDrag(x) {
  if (draggingChar) {
    draggingChar.x = x - dragOffsetX;
    draw();
  }
}

function endDrag() {
  draggingChar = null;
}

canvas.addEventListener('mousedown', e => startDrag(e.offsetX, e.offsetY));
canvas.addEventListener('mousemove', e => moveDrag(e.offsetX));
canvas.addEventListener('mouseup', endDrag);

canvas.addEventListener('touchstart', e => {
  const touch = e.touches[0];
  const rect = canvas.getBoundingClientRect();
  startDrag(touch.clientX - rect.left, touch.clientY - rect.top);
});
canvas.addEventListener('touchmove', e => {
  const touch = e.touches[0];
  const rect = canvas.getBoundingClientRect();
  moveDrag(touch.clientX - rect.left);
});
canvas.addEventListener('touchend', endDrag);

</script>
</body>
</html>
